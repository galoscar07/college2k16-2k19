<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>sortedmap.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
	<body onload="prettyPrint()">
        <h4></h4>
		<pre class="prettyprint lang-cpp linenums">
//
//  SortedMap.cpp
//  DSAProject
//
//  Created by Gal Oscar on 09/06/2017.
//  Copyright Â© 2017 Gal Oscar. All rights reserved.
//
#include &lt;string&gt;
#include &lt;exception&gt;
#include &lt;assert.h&gt;
#include "SortedMap.hpp"
#include &lt;iostream&gt;

<span style = "background-color:#dfd">bool relation(TElement a, TElement b){
    if (a.key &gt; b.key) {
        return true;</span>
    }
<span style = "background-color:#dfd">    return false;
}</span>


// ----------------------------------------------------------- SORTED MAP ---------------------------------------------------------------------

<span style = "background-color:#dfd">SortedMap::SortedMap(bool(*r)(TElement,TElement)){
    this-&gt;root = NULL;                  
    this-&gt;relation = r;
}</span>

<span style = "background-color:#dfd">SortedMap::~SortedMap(){</span>
    
<span style = "background-color:#dfd">}</span>


<span style = "background-color:#dfd">std::string SortedMap::search(std::string key){
    TElement something;
    something.key = key;
    something.value = "0";</span>
    
<span style = "background-color:#dfd">    Node* currentNode = this-&gt;root;
    while (currentNode != NULL &amp;&amp; currentNode-&gt;info.key != key){
        if (!this-&gt;relation(currentNode-&gt;info, something)){
            currentNode = currentNode-&gt;right;</span>
        }
<span style = "background-color:#dfd">        else {
            currentNode = currentNode-&gt;left;</span>
        }
<span style = "background-color:#dfd">    }
    if (currentNode == NULL){
        return "0";</span>
    }
<span style = "background-color:#dfd">    return currentNode-&gt;info.value;
}</span>


<span style = "background-color:#dfd">void SortedMap::add(std::string key, std::string value){
    TElement something;
    something.key = key;
    something.value = value;
    std::string exist = this-&gt;search(key);
    if (exist != "0"){
        throw (std::string)"The element is already in the container";</span>
    }
<span style = "background-color:#dfd">    this-&gt;insertRec(&amp;this-&gt;root, something);
}</span>

<span style = "background-color:#dfd">void SortedMap::insertRec(Node** n, TElement something){
    if (*n == NULL){
        *n = new Node;
        (*n)-&gt;info = something;
        (*n)-&gt;left = NULL;
        (*n)-&gt;right = NULL;</span>
    }
<span style = "background-color:#dfd">    else if (this-&gt;relation((*n)-&gt;info, something)) {
        this-&gt;insertRec(&amp;(*n)-&gt;left, something);</span>
    }
<span style = "background-color:#dfd">    else {
        this-&gt;insertRec(&amp;(*n)-&gt;right, something);</span>
    }
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">void SortedMap::sizeRec(int &amp;nr, Node* n){
    if (n == NULL) {
        return;</span>
    }
<span style = "background-color:#dfd">    nr++;
    this-&gt;sizeRec(nr, n-&gt;left);
    this-&gt;sizeRec(nr, n-&gt;right);
}</span>


<span style = "background-color:#dfd">int SortedMap::size(){
    int nr = 0;
    this-&gt;sizeRec(nr, this-&gt;root);
    return nr;
}</span>


<span style = "background-color:#dfd">Iterator SortedMap::iterator(){
    Iterator it{this};
    return it;
}</span>

<span style = "background-color:#dfd">Node* SortedMap::minimum(Node* n){
    Node* currentNode = n;
    while(currentNode-&gt;left != NULL){</span>
<span style = "background-color:#fdd">        currentNode = currentNode-&gt;left;
    }</span>
<span style = "background-color:#dfd">    return currentNode;
}</span>



<span style = "background-color:#dfd">Node* SortedMap::removeRec(Node * n, std::string key){
    int isRoot = 0;
    if (n == NULL)</span>
<span style = "background-color:#fdd">        return n;</span>
<span style = "background-color:#dfd">    else if (key &lt; n-&gt;info.key)
        n-&gt;left = this-&gt;removeRec(n-&gt;left, key);
    else if (key &gt; n-&gt;info.key)</span>
<span style = "background-color:#fdd">        n-&gt;right = this-&gt;removeRec(n-&gt;right, key);
    else {</span>
<span style = "background-color:#dfd">        if (n-&gt;left == NULL &amp;&amp; n-&gt;right == NULL) {
            if (n == this-&gt;root)
                this-&gt;root = NULL;
            delete n;
            n = NULL;</span>
        }
<span style = "background-color:#dfd">        else if (n-&gt;right == NULL) {
            if (n == this-&gt;root) isRoot = 1;
            Node* aux = n;
            n = n-&gt;left;
            delete aux;
            if (isRoot == 1)
                this-&gt;root = n;
        }
        else if (n-&gt;left == NULL) {
            if (n == this-&gt;root) isRoot = 1;
            Node* aux = n;
            n = n-&gt;right;
            delete aux;
            if (isRoot == 1)
                this-&gt;root = n;</span>
        }
<span style = "background-color:#dfd">        else {
            if (n == this-&gt;root) isRoot = 1;
            Node* aux = this-&gt;minimum(n-&gt;right);
            n-&gt;info = aux-&gt;info;
            n-&gt;right = removeRec(n-&gt;right, aux-&gt;info.key);
            if (isRoot == 1)
                this-&gt;root = n;</span>
        }
    }
<span style = "background-color:#dfd">    return n;</span>
    
<span style = "background-color:#dfd">}</span>


<span style = "background-color:#dfd">void SortedMap::remove(std::string key){
    std::string exist = this-&gt;search(key);
    if (exist == "0"){
        throw (std::string)"The element is not in the container";</span>
    }
<span style = "background-color:#dfd">    this-&gt;removeRec(this-&gt;root, key);
}</span>


// ----------------------------------------------------------------- ITERATOR ------------------------------------------------------------------

<span style = "background-color:#dfd">Iterator::~Iterator(){</span>
    
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">Iterator::Iterator(SortedMap* sortMap){
    this-&gt;sm = sortMap;
    Node *nod = this-&gt;sm-&gt;root;
    while (nod != NULL){
        this-&gt;s.push(nod);
        nod = nod-&gt;left;
    }
    if (!this-&gt;s.empty()){
        this-&gt;currentNode = this-&gt;s.top();</span>
    }
<span style = "background-color:#dfd">    else{
        this-&gt;currentNode = NULL;</span>
    }
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">TElement Iterator::getCurrent(){
    return this-&gt;currentNode-&gt;info;
}</span>

<span style = "background-color:#dfd">bool Iterator::valid(){
    if (this-&gt;currentNode == NULL){
        return false;</span>
    }
<span style = "background-color:#fdd">    else{</span>
<span style = "background-color:#dfd">        return true;</span>
    }
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">void Iterator::next(){
    Node* nod = this-&gt;s.top();
    this-&gt;s.pop();
    if (nod-&gt;right != NULL){
        nod = nod-&gt;right;
        while (nod != NULL){
            this-&gt;s.push(nod);
            nod = nod-&gt;left;
        }</span>
    }
<span style = "background-color:#dfd">    if (!this-&gt;s.empty()){
        this-&gt;currentNode = this-&gt;s.top();</span>
    }
<span style = "background-color:#dfd">    else{
        this-&gt;currentNode = NULL;</span>
    }
<span style = "background-color:#dfd">}</span>

// ---------------------------------------------------- Tests -----------------------------------------------------------------------------

<span style = "background-color:#dfd">void Tests::testAll(){
    testAdd();
    testRemove();
    testSearch();
    testSize();
    testRelation();
    testIterator();</span>
    
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">void Tests::testAdd(){
    SortedMap sm{&amp;relation};
    sm.add("Ghost","A");
    sm.add("Chair","B");
    assert(sm.size() == 2);
    sm.add("Inspiration","C");
    sm.add("Apple","d");
    sm.add("Word","haha");
    assert(sm.size() == 5);
    try {
        sm.add("Ghost", "bla bla");</span>
<span style = "background-color:#fdd">		assert(false);</span>
    } catch (std::string &amp;e){
		assert(true);
<span style = "background-color:#dfd">    }
}</span>

<span style = "background-color:#dfd">void Tests::testSize(){
    SortedMap sm{&amp;relation};
    assert(sm.size() == 0);
    sm.add("Ghost","A");
    sm.add("Chair","B");
    assert(sm.size() == 2);
    sm.remove("Ghost");
    assert(sm.size() == 1);
}</span>

<span style = "background-color:#dfd">void Tests::testSearch(){
    SortedMap sm{&amp;relation};
    sm.add("Ghost","A");
    sm.add("Chair","B");
    assert(sm.search("Ghost") == "A");
    assert(sm.search("Something") == "0");
}</span>

<span style = "background-color:#dfd">void Tests::testIterator(){
    SortedMap sm{&amp;relation};
	Iterator it2 = sm.iterator();
	assert(it2.valid() == false);
    sm.add("Ghost","A");
    sm.add("Chair","B");
    sm.add("Inspiration","C");
    sm.add("Apple","d");
    sm.add("Word","haha");
	Iterator it = sm.iterator();
    assert(it.valid() == true);
    assert(it.getCurrent().key == "Apple");
    it.next();
    assert(it.getCurrent().key == "Chair");
    it.next();
    it.next();
    it.next();
    it.next();
    assert(it.valid() == false);</span>
    
<span style = "background-color:#dfd">}</span>

<span style = "background-color:#dfd">void Tests::testRelation(){
    TElement a,b;
    a.key = "aa";
    b.key = "bb";
    a.value = "";
    b.value = "";
    assert(relation(a, b) == false);
    assert(relation(b, a) == true);
}</span>

<span style = "background-color:#dfd">void Tests::testRemove(){
    SortedMap sm{&amp;relation};
    sm.add("Ghost","A");
    sm.add("Chair","B");
    sm.add("Inspiration","C");
    sm.add("Apple","d");
    sm.add("Word","haha");
    sm.remove("Ghost");
    assert(sm.size() == 4);
    sm.remove("Apple");
    assert(sm.size() == 3);
    sm.remove("Chair");
    assert(sm.size() == 2);
    sm.remove("Inspiration");
    assert(sm.size() == 1);
    sm.remove("Word");
    assert(sm.size() == 0);
    try {
        sm.remove("Ghost");</span>
<span style = "background-color:#fdd">		assert(false);</span>
    } catch (std::string &amp;e){
		assert(true);
<span style = "background-color:#dfd">    }
}</span></pre>
	</body>
</html>