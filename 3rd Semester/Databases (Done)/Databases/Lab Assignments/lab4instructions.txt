Hi, all :)

Pentru laboratorul 4 va trebui sa implementati o serie de
proceduri/functii care sa va ajute sa testati baza de date.
Testele vor trebui rulate pe:
t1. un tabel cu o coloana PK si fara FK;
t2. un tabel cu o coloana PK si cel putin un FK;
t3. un tabel cu PK compus din doua coloane - adica un tabel de legatura
pentru o relatie many to many;
v1. un view pe un singur tabel;
v2. un view pe cel putin doua tabele;
v3. un view pe cel putin doua tabele, avand si GROUP BY.

Va sfatuiesc sa alegeti tabelele si view-urile astfel incat sa grupati t1
+ v1, t2 + v2 si t3 + v3, iar t1, t2 si t3 sa fie interconectate (de
exemplu, t3 e tabelul pentru relatia many to many intre t1 si t2).

Aveti atasat cerintei un SQL query care o sa va creeze o structura de
tabele de care o sa va folositi.
In aceste tabele o sa aveti stocata configuratia pentru teste si
rezultatele obtinute in urma rularii testelor.

Tabele pre-completate (inainte de executia testelor): Tests, Tables,
Views, TestTables, TestViews.
Tabele completate in timpul executiei: TestRuns, TestRunTables, TestRunViews.

O executie a unui test (un TestRun) presupune, pe rand:
1. stergerea datelor din tabel (ultimele n randuri inserate)
2. inserarea a n randuri in tabel
3. evaluarea view-ului care lucreaza pe tabelul curent

=> cele 3 puncte reprezinta un TestRun
Un TestRun este impartit in:
- un TestRunTable (punctele 1 si 2)
- un TestRunView (punctul 3)

Pentru punctele 1 si 2, valoarea n este valoarea configurata in coloana
NoOfRows din TestTables.
De asemenea, coloana Position din TestTables o sa va ajute sa determinati
ordinea in care se desfasoara pasii testelor pentru a satisface
constraint-urile de tip FK.

Scenariu de test:

Avem procedura spExecuteTest, care primeste ca parametru un TestID din
cele stocate in tabelul Tests.

La executia procedurii, se vor intampla urmatoarele:
- inserez un rand nou in TestRun, cu valoarea GETDATE() pe StartAt si o
valoare dummy pe EndAt. Tin minte TestRunID-ul curent, pentru further use;
- inserez un rand nou in TestRunTables, cu TestRunID-ul memorat, valoarea
GETDATE() pe StartAt si o valoare dummy pe EndAt;
- sterg ultimele n randuri din tabelul corespunzator testului rulat;
- inserez n randuri in tabelul corespunzator testului rulat;
- fac update (cu GETDATE()) valorii EndAt din randul inserat in
TestRunTables;
- inserez un rand nou in TestRunViews, cu TestRunID-ul memorat, valoarea
GETDATE() pe StartAt si o valoare dummy pe EndAt;
- execut SELECT * din view-ul corespunzator testului curent;
- fac update (cu GETDATE()) valorii EndAt din randul inserat in TestRunView;
- fac update (cu GETDATE()) valorii EndAt din randul inserat in TestRuns.

Va rog sa notati orice intrebare aveti, pentru a discuta tot ce se poate
in orele de laborator de saptamana viitoare.
Daca sunt intrebari mai urgente, le astept pe mail.

Un weekend fain sa aveti!

Larisa
